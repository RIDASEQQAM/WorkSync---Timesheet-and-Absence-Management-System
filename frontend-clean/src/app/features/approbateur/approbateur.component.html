<div class="approbateur-container">
    <h1 class="title">Gestion des Feuilles de Temps</h1>

    <div class="navigation">
        <button [class.active]="currentView === 'creation'" (click)="changerVue('creation')">Cr√©ation</button>
        <button [class.active]="currentView === 'en-attente'" (click)="changerVue('en-attente')">En attente
            ({{feuillesEnAttente.length}})</button>
        <button [class.active]="currentView === 'approuvees'" (click)="changerVue('approuvees')">Approuv√©es
            ({{feuillesApprouvees.length}})</button>
        <button [class.active]="currentView === 'rejetees'" (click)="changerVue('rejetees')">Rejet√©es
            ({{feuillesRejetees.length}})</button>
    </div>

    <!-- Vue Cr√©ation -->
    <div class="formulaire-ajout" *ngIf="currentView === 'creation'" role="form" aria-labelledby="timesheet-title">
        <h2 id="timesheet-title">Timesheets üïô</h2>

        <div class="form-group">
            <label for="employee-name">Nom de l'employ√©:</label>
            <input 
                id="employee-name"
                type="text" 
                [(ngModel)]="nouvelleFeuille.employe" 
                placeholder="Votre nom"
                aria-label="Nom de l'employ√©">
        </div>

        <div class="form-group">
            <label id="period-label">P√©riode travaill√©e:</label>
            <div class="periode-input" role="group" aria-labelledby="period-label">
                <input 
                    id="period-input"
                    type="text" 
                    [(ngModel)]="nouvelleFeuille.periode" 
                    placeholder="S√©lectionnez une p√©riode"
                    readonly
                    aria-label="P√©riode s√©lectionn√©e"
                    [attr.aria-expanded]="showCalendar">
                <button 
                    class="calendar-btn" 
                    (click)="toggleCalendar()"
                    (keydown.enter)="toggleCalendar()"
                    (keydown.space)="toggleCalendar(); $event.preventDefault()"
                    aria-label="Ouvrir le calendrier">
                    <span aria-hidden="true">üìÖ</span>
                </button>
            </div>

            <div class="calendar" *ngIf="showCalendar" role="dialog" aria-label="Calendrier">
                <div class="calendar-header" role="navigation">
                    <button 
                        (click)="previousMonth()" 
                        (keydown.enter)="previousMonth()"
                        aria-label="Mois pr√©c√©dent">
                        <span aria-hidden="true">‚óÄ</span>
                    </button>
                    <span role="heading" aria-level="3">{{ getMonthName(currentMonth) }} {{ currentYear }}</span>
                    <button 
                        (click)="nextMonth()"
                        (keydown.enter)="nextMonth()"
                        aria-label="Mois suivant">
                        <span aria-hidden="true">‚ñ∂</span>
                    </button>
                </div>
                <div class="calendar-grid" role="grid">
                    <div class="day-header" role="row">
                        <div role="columnheader" *ngFor="let day of ['Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam', 'Dim']">
                            {{ day }}
                        </div>
                    </div>
                    <div role="row" *ngFor="let week of generateCalendarDays() | chunk:7">
                        <button 
                            role="gridcell" 
                            *ngFor="let day of week" 
                            class="day"
                            [attr.tabindex]="day.isCurrentMonth ? 0 : -1"
                            (click)="selectDay(day)"
                            (keydown.enter)="selectDay(day)"
                            (keydown.space)="selectDay(day); $event.preventDefault()"
                            [attr.aria-label]="formatDayAriaLabel(day)"
                            [attr.aria-selected]="isSelectedDay(day)"
                        [class.selected-start]="isSelectedStart(day)" [class.selected-end]="isSelectedEnd(day)"
                        [class.in-range]="isInRange(day)" (click)="selectDate(day)">
                        {{ day.getDate() }}
                    </div>
                </div>
            </div>
        </div>

        <div class="form-group">
            <label for="hours-worked">Heures travaill√©es:</label>
            <input 
                id="hours-worked"
                type="number" 
                [(ngModel)]="nouvelleFeuille.heures" 
                min="0" 
                step="0.5"
                aria-label="Heures travaill√©es"
                placeholder="Entrez le nombre d'heures">
        </div>

        <button class="btn-ajouter" (click)="ajouterFeuille()">Soumettre</button>
    </div>

    <!-- Vue En Attente -->
    <div class="pending-list" *ngIf="currentView === 'en-attente' && feuillesEnAttente.length > 0">
        <table>
            <thead>
                <tr>
                    <th>Employ√©</th>
                    <th>P√©riode</th>
                    <th>Heures</th>
                    <th>Date Soumission</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let feuille of feuillesEnAttente">
                    <td>{{ feuille.employe }}</td>
                    <td>{{ feuille.periode }}</td>
                    <td>{{ feuille.heures }}h</td>
                    <td>{{ feuille.dateSoumission | date:'dd/MM/yyyy' }}</td>
                    <td class="actions">
                        <button class="btn-voir" (click)="voirFeuille(feuille)">Voir</button>
                        <button class="btn-approuver" (click)="approuver(feuille)">Approuver</button>
                        <button class="btn-rejeter" (click)="ouvrirRejet(feuille)">Rejeter</button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Vue Approuv√©es -->
    <div class="approved-list" *ngIf="currentView === 'approuvees' && feuillesApprouvees.length > 0">
        <table>
            <thead>
                <tr>
                    <th>Employ√©</th>
                    <th>P√©riode</th>
                    <th>Heures</th>
                    <th>Date Approbation</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let feuille of feuillesApprouvees">
                    <td>{{ feuille.employe }}</td>
                    <td>{{ feuille.periode }}</td>
                    <td>{{ feuille.heures }}h</td>
                    <td>{{ feuille.dateSoumission | date:'dd/MM/yyyy' }}</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Vue Rejet√©es -->
    <div class="rejected-list" *ngIf="currentView === 'rejetees' && feuillesRejetees.length > 0">
        <table>
            <thead>
                <tr>
                    <th>Employ√©</th>
                    <th>P√©riode</th>
                    <th>Heures</th>
                    <th>Date Rejet</th>
                    <th>Commentaire</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let feuille of feuillesRejetees">
                    <td>{{ feuille.employe }}</td>
                    <td>{{ feuille.periode }}</td>
                    <td>{{ feuille.heures }}h</td>
                    <td>{{ feuille.dateSoumission | date:'dd/MM/yyyy' }}</td>
                    <td>{{ feuille.commentaireRejet }}</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Modal -->
    <div class="modal" *ngIf="feuilleSelectionnee">
        <div class="modal-content">
            <h2 *ngIf="!rejetMode">D√©tails de la feuille</h2>
            <h2 *ngIf="rejetMode">Rejet de la feuille</h2>

            <div *ngIf="!rejetMode">
                <p><strong>Employ√©:</strong> {{ feuilleSelectionnee.employe }}</p>
                <p><strong>P√©riode:</strong> {{ feuilleSelectionnee.periode }}</p>
                <p><strong>Heures:</strong> {{ feuilleSelectionnee.heures }}h</p>
                <p><strong>Date Soumission:</strong> {{ feuilleSelectionnee.dateSoumission | date:'dd/MM/yyyy' }}</p>

                <div class="modal-actions">
                    <button class="btn-approuver" (click)="approuver(feuilleSelectionnee)">Approuver</button>
                    <button class="btn-rejeter" (click)="ouvrirRejet(feuilleSelectionnee)">Rejeter</button>
                    <button class="btn-fermer" (click)="fermerModal()">Fermer</button>
                </div>
            </div>

            <div *ngIf="rejetMode">
                <p>Vous √™tes sur le point de rejeter la feuille de {{ feuilleSelectionnee.employe }}</p>
                <textarea [(ngModel)]="commentaireRejet"
                    placeholder="Veuillez indiquer la raison du rejet..."></textarea>

                <div class="modal-actions">
                    <button class="btn-confirmer" (click)="confirmerRejet()">Confirmer Rejet</button>
                    <button class="btn-annuler" (click)="annulerRejet()">Annuler</button>
                </div>
            </div>
        </div>
    </div>
</div>